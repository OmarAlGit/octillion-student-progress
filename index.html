<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Group 1 — Student Assessments</title>
<style>
:root {
  --bg: #10161d;
  --panel: #1a212b;
  --firstcol: #cfd3d7;
  --header: #d4e6fa;
  --grid: #2b323a;
  --green: #42b972;
  --red: #d15b4a;
}

body {
  background: var(--bg);
  color: #fff;
  font-family: "Inter", sans-serif;
  margin: 0;
  padding: 2rem;
  overflow-x: hidden;
}

h1 {
  text-align: center;
  margin-bottom: 1.5rem;
  font-size: 1.4rem;
}

.board {
  border: 1px solid var(--grid);
  background: var(--panel);
  border-radius: 14px;
  overflow-x: auto;
  box-shadow: 0 20px 60px rgba(0,0,0,.35);
}

table {
  border-collapse: collapse;
  width: 100%;
  min-width: 1100px;
}

th, td {
  border: 1px solid var(--grid);
  padding: 0.6rem;
  text-align: center;
}

thead th {
  background: var(--header);
  color: #000;
  font-weight: 700;
  font-size: 1rem;
  padding: 1rem;
}

thead th small {
  display: block;
  font-size: 0.85rem;
  font-weight: 600;
}

tbody td:first-child {
  background: var(--firstcol);
  color: #0b0f13;
  font-weight: 800;
  text-align: center;
  position: sticky;
  left: 0;
  z-index: 4;
  vertical-align: middle;
  min-width: 220px;
  height: 90px;
  line-height: 1.3;
  font-size: 18px;
  border-right: 1px solid var(--grid);
  border-bottom: 1px solid var(--grid);
}

.status {
  display: inline-block;
  border-radius: 16px;
  padding: 1rem;
  color: #fff;
  font-weight: 700;
  width: 180px;
  font-size: 0.9rem;
  line-height: 1.3;
}

.green { background: var(--green); }
.red { background: var(--red); }

.legend {
  display: flex;
  justify-content: center;
  gap: 2rem;
  margin-top: 1rem;
  font-size: 0.9rem;
}
.legend span {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}
.legend .dot {
  width: 20px;
  height: 20px;
  border-radius: 50%;
}
.legend .green { background: var(--green); }
.legend .red { background: var(--red); }
</style>
</head>
<body>
  <h1>Group 1 — Student Assessments</h1>
  <div class="board">
    <table id="progressTable">
      <thead id="tableHead"></thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>
  <div class="legend">
    <span><div class="dot green"></div> Completed</span>
    <span><div class="dot red"></div> Not Completed</span>
  </div>

<script>
// ✅ Google Sheet CSV (Tracking Sheet)
const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRTW5UzVfnAcBJdW9fSL7SXFc0wtUV5ftFWKaFExTPhq7FTv5QZ0rHqjs4sLlBnFHzCi0ThHMzV3rT_/pub?gid=1926586971&single=true&output=csv";

async function loadData() {
  const res = await fetch(sheetUrl);
  const text = await res.text();
  const rows = text.trim().split("\n").map(r => r.split(","));

  // Headers
  const headerRow = ["Group 1", "H&S", "H&S 1", "H&S 2", "H&S 3", "H&S 4", "H&S 5", "H&S 6", "H&S 7"];
  const subheaders = ["", "Health & Safety Practices", "Identifying Hazards", "Manual Handling", "Manual Handling using lifting aids", "Ladders", "Standsteps", "Scaffold", "Safety Signs"];

  // Auto-detected student list (from sheet)
  const students = Array.from(new Set(rows.map(r => r[4]).filter(x => x && x !== "Name" && !x.match(/Totals/i))));

  // Map of task -> student -> status
  const taskMap = {};
  rows.forEach(r => {
    const date = r[0]?.trim();
    const task = (r[1]?.trim() || "") + " " + (r[2]?.trim() || "");
    const student = r[4]?.trim();
    if (!student || student === "Name") return;
    if (!taskMap[task]) taskMap[task] = {};
    taskMap[task][student] = date;
  });

  // Table header
  const thead = document.getElementById("tableHead");
  thead.innerHTML = `
    <tr>${headerRow.map((h, i) => `<th>${h}${subheaders[i] ? `<small>${subheaders[i]}</small>` : ""}</th>`).join("")}</tr>
  `;

  // Table body
  const tbody = document.getElementById("tableBody");
  tbody.innerHTML = students.map(student => `
    <tr>
      <td>${student}</td>
      ${headerRow.slice(1).map((h, i) => {
        const topic = h + " " + (subheaders[i+1] || "");
        const status = taskMap[topic]?.[student];
        if (!status || status === "N" || status === "") {
          return `<td><div class="status red">Not Completed</div></td>`;
        } else {
          return `<td><div class="status green">Completed:<br>${status}</div></td>`;
        }
      }).join("")}
    </tr>
  `).join("");
}

loadData();
</script>
</body>
</html>
